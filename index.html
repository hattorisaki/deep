<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Meine Mediathek</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            padding: 15px;
            background-color: #0f0f0f;
            color: #ffffff;
        }

        /* Suchleiste */
        .search-container {
            position: sticky;
            top: 0;
            background-color: #0f0f0f;
            padding: 10px 0 20px 0;
            z-index: 100;
        }

        #suche {
            width: 100%;
            padding: 15px;
            border-radius: 12px;
            border: 1px solid #333;
            background-color: #1e1e1e;
            color: white;
            font-size: 16px;
            box-sizing: border-box;
            outline: none;
        }

        /* Container für die Liste */
        #video-liste {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        /* Die Video-Kachel */
        .video-kachel {
            display: block;
            background-color: #1e1e1e;
            border-radius: 16px;
            overflow: hidden;
            text-decoration: none;
            color: white;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }

        .video-container {
            width: 100%;
            height: 210px;
            background-color: #000;
            position: relative;
        }

        video {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }

        .text-bereich {
            padding: 15px;
        }

        .titel {
            margin: 0;
            font-size: 17px;
            font-weight: 600;
            line-height: 1.3;
        }

        .untertitel {
            margin: 5px 0 0 0;
            font-size: 14px;
            color: #aaaaaa;
        }

        /* Fehlermeldung Style */
        .error-box {
            background: #331111;
            color: #ffaaaa;
            padding: 15px;
            border-radius: 10px;
            border: 1px solid red;
            font-size: 14px;
        }
    </style>
</head>
<body>

    <div class="search-container">
        <input type="text" id="suche" placeholder="Suche nach Titel oder Creator...">
    </div>

    <div id="video-liste">
        <p>Lade Datenbank...</p>
    </div>

    <script>
        let alleVideosDaten = [];
        const listeContainer = document.getElementById('video-liste');

        // Funktion 1: Daten aus der videos.json laden
        async function ladeDatenbank() {
            try {
                // Fetch versucht die Datei im gleichen Ordner zu finden
                const antwort = await fetch('videos.json');
                
                if (!antwort.ok) {
                    throw new Error(`videos.json wurde nicht gefunden (Server-Status: ${antwort.status}). Stelle sicher, dass die Datei exakt "videos.json" heißt.`);
                }

                const daten = await antwort.json();
                alleVideosDaten = daten;
                
                if (alleVideosDaten.length === 0) {
                    listeContainer.innerHTML = "<p>Die videos.json ist leer. Füge Videos hinzu!</p>";
                } else {
                    renderVideos(alleVideosDaten);
                }

            } catch (fehler) {
                // Zeigt den Fehler direkt auf der Webseite an
                listeContainer.innerHTML = `
                    <div class="error-box">
                        <strong>Ladefehler:</strong><br>
                        ${fehler.message}
                    </div>
                `;
                console.error("Details:", fehler);
            }
        }

        // Funktion 2: Die Kacheln ins HTML schreiben
        function renderVideos(liste) {
            listeContainer.innerHTML = ""; // Container leeren
            
            if (liste.length === 0) {
                listeContainer.innerHTML = "<p>Keine Treffer gefunden.</p>";
                return;
            }

            liste.forEach(video => {
                const kachel = document.createElement('a');
                kachel.className = 'video-kachel';
                kachel.href = video.link;
                kachel.target = '_blank';
                
                kachel.innerHTML = `
                    <div class="video-container">
                        <video src="${video.videoUrl}" muted loop playsinline preload="metadata"></video>
                    </div>
                    <div class="text-bereich">
                        <h3 class="titel">${video.titel}</h3>
                        <p class="untertitel">${video.creator}</p>
                    </div>
                `;
                listeContainer.appendChild(kachel);
            });

            starteBeobachter();
        }

        // Funktion 3: Suche-Eingabe verarbeiten
        document.getElementById('suche').addEventListener('input', (e) => {
            const begriff = e.target.value.toLowerCase();
            const gefiltert = alleVideosDaten.filter(v => 
                v.titel.toLowerCase().includes(begriff) || 
                v.creator.toLowerCase().includes(begriff)
            );
            renderVideos(gefiltert);
        });

        // Funktion 4: Der Auto-Play Beobachter
        function starteBeobachter() {
            const beobachter = new IntersectionObserver((eintraege) => {
                eintraege.forEach(eintrag => {
                    const vid = eintrag.target;
                    if (eintrag.isIntersecting) {
                        // Video startet, wenn es sichtbar ist
                        vid.play().catch(e => console.log("Autoplay blockiert:", e));
                    } else {
                        // Video stoppt, wenn man wegscrollt
                        vid.pause();
                        vid.currentTime = 0;
                    }
                });
            }, { threshold: 0.6 }); // 60% des Videos müssen sichtbar sein

            document.querySelectorAll('video').forEach(v => beobachter.observe(v));
        }

        // Alles starten
        ladeDatenbank();
    </script>

</body>
</html>
